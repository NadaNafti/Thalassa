{% extends ":Back:base.html.twig" %}
{% block title %}Tarif & Dispo{% endblock %}
{% block description %}{% endblock %}
{% block topbody %}   
    {{ parent() }}
    <li>
        <a href="javascript:void(0)" >Tarif & Dispo</a>
    </li>
{% endblock %}
{% block body %}

    <div class="row">
        <div class="col-sm-12">
            <div class="tabbable">
                <ul id="myTab" class="nav nav-tabs tab-bricky">
                    <li class="active">
                        <a href="#details_reservation" data-toggle="tab">
                            <i class="green fa fa-home"></i> Détails Réservation
                        </a>
                    </li>
                    <li>
                        <a href="#formulaire_reservation" data-toggle="tab">
                            Formulaire
                        </a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane in active" id="details_reservation">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="row">
                                    <div class="col-sm-4">
                                        <h2 class="center">{{ hotel }}</h2>
                                        <h5 class="center">{{ getStars(hotel.getStars)|raw }}</h5>
                                        <p><strong>Fournisseur  : </strong>{{ hotel.fournisseur }}</p>
                                        <p><strong>Ville  : </strong> {{ hotel.ville.pays|upper }} {{ hotel.ville }}</p>
                                        <p><strong>Date debut : </strong> {{ dateDebut|date('d/m/Y') }}</p>
                                        <p><strong> Nuitées : </strong> {{ nuitees }}</p>
                                        <p><strong>Date Fin : </strong> {{ dateFin|date('d/m/Y') }}</p>
                                        <hr>
                                        <p><strong> Client : </strong> {{ client }}</p>
                                        {% if client.amicale is not null %}
                                            <p><strong> Amicale : </strong> {{ client.amicale }}</p>
                                            {% set convention= client.amicale.getConventionByDateHotel(dateDebut|date('Y-m-d'),hotel.id) %}
                                            {% if convention is null %}
                                                <p><strong> Convention : </strong> Pas de convention</p>
                                            {% else %}
                                                <p><strong> Convention : </strong> {{ convention.remise }}%</p>
                                                <p><strong> Type Remise : </strong> {{ convention.showTypeRemise }}</p>
                                                <p><strong> Type convention : </strong> {{ convention.showType }}</p>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                    <div class="col-sm-6">
                                        <div id='calendar'></div>
                                    </div>
                                </div>
                                <div class="row">
                                    <hr>
                                    <div class="col-sm-12" id="SaisonBlock">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="formulaire_reservation">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="panel panel-default">
                                    <div class="panel-body">
                                        <h2><i class="fa fa-plus-square teal"></i> Nouvelle réservation <small>{{ saison }}</small></h2>
                                        <hr>
                                        <form action="#" role="form" id="form">
                                            <div class="panel-body">
                                                {% for chambre in saison.chambres %}
                                                    <div class="row">
                                                        <div class="row"  style="  padding: 10px;  background-color: #eee;">
                                                            <div class="col-md-2">
                                                                <label>{{ chambre.chambre }}</label>
                                                                <select name="chambre_{{ chambre.id }}" data-id="{{ chambre.id }}" class="form-control chambres">
                                                                    {% for i in 0..20 %}
                                                                        <option name="{{ i }}" >{{ i }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                            {#<div class="col-md-4">
                                                                A partir de <strong> {{saison.prixBaseVente+chambre.getSuppReducVente}}</strong> DT par personne en <strong>{{ saison.arrBase }}</strong>
                                                            </div>#}
                                                        </div>
                                                        <div class="row details"></div>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                            {{ formulaire.submit("Suivant") }}
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}
{% block jquery %}
    <script>
        $(document).ready(function() {
            $('#calendar').fullCalendar({
        month:{{ dateDebut|date('m')-1 }},
                year:{{ dateDebut|date('Y') }},
                events: [
        {% for day in calendrier %}
                    {
                    id:{{ day.saison.id }},{% if day.saison.type is null %}
                            color: '#F0AD4E',{% elseif day.saison.type ==1 %}
                            color: '#555',{% else %}
                            color: '#569099',{% endif %}
                            title: '{{ day.saison }}',
                            start: '{{ day.dateDebut }}',
                            end: '{{ day.dateFin }}',
                            url: 'javascript:void(0)'
                    },{% endfor %}
                    ],
                    eventClick: function(event) {
                    $('#SaisonBlock').html('<div class="center"><img  src="{{ asset('back-assets/images/loading1.gif') }}" /></div>');
                            $.ajax({
                            url: '{{ path('gey_saison_ajax') }}',
                                    data: { 'id' : event.id },
                                    type: 'POST',
                                    dataType: 'html',
                                    success: function(data) {
                                    $('#SaisonBlock').hide().html(data).fadeIn('slow');
                                    }
                            });
                    }
            })
            $('.chambres').change(function(){
                var nbrRooms = $(this).val();
                var id=$(this).data('id');
                Block = $(this).parent().parent().parent().find('.details');
                var exist = Block.children().length;
                if (exist < nbrRooms)
                {
                for (var i = 1; i <= nbrRooms; i++)
                {
                if (i > exist)
                        Block.append('<div class="row" style="  border: 1px solid #eee;  padding: 10px 0px;  margin: 15px 0px;"><div class="col-md-2" style="padding-top: 25px;">Chambre '+i+' </div>'+$('#squelette_'+id).html()+'</div>');
                }
                }
                else
                {
                var toRemove = (exist - nbrRooms);
                        var nmbr = Block.children().length;
                        for (var i = nmbr; i >= (nmbr - toRemove); i--)
                        Block.children().eq(i).remove();
                }
                })
                });
        </script>
        {% for ch in saison.chambres %}
            <div class="no-display" id="squelette_{{ ch.id }}">
                <div class="col-md-1">
                    <label>Adulte</label>
                    <select name="client" class="form-control">
                        {% for i in ch.maxAdulte..ch.minAdulte %}
                            <option name="{{ i }}" >{{ i }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-1">
                    <label>Enfant</label>
                    <select name="client" class="form-control">
                        {% for i in ch.minEnfant..ch.maxEnfant %}
                            <option name="{{ i }}" >{{ i }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <label>arrangement</label>
                    <select name="client" class="form-control">
                        <option name="1" >Arr de base LDP</option>
                    </select>
                </div>
                {% for i in 1..5 %}
                    <div class="col-md-1">
                        <label>Age {{ loop.index }} </label>
                        <select name="client" class="form-control">
                            {% for i in 1..17 %}
                                <option name="{{ i }}" >{{ i }}</option>
                            {% endfor %}
                        </select>
                    </div>
                {% endfor %}
                <div class="col-md-2"></div>
                <div class="col-md-10">
                    <label><input checked disabled type="checkbox"/> Supplément dinner gala   </label>
                </div>
                <div class="col-md-2"></div>
                <div class="col-md-10">
                    <label><input type="checkbox"/> Vue mer  </label>
                </div>
                <div class="col-md-2"></div>
                <div class="col-md-10">
                    <label> Réduction saint valentin  </label>
                </div>
            </div>
        {% endfor %}
        {% endblock %}